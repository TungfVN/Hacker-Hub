-- Fly GUI with Larger Buttons - FIXED NO TELEPORT
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Create ScreenGui
local flyGui = Instance.new("ScreenGui")
flyGui.Name = "FlyGUI"
flyGui.Parent = playerGui

-- Logo/Toggle button (Larger)
local toggleButton = Instance.new("ImageButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(0, 90, 0, 90)
toggleButton.Position = UDim2.new(0, 20, 0, 20)
toggleButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
toggleButton.BackgroundTransparency = 0.2
toggleButton.Image = "rbxassetid://86019416633420"
toggleButton.ImageColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.ScaleType = Enum.ScaleType.Fit
toggleButton.ZIndex = 10
toggleButton.Parent = flyGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 14)
toggleCorner.Parent = toggleButton

local toggleStroke = Instance.new("UIStroke")
toggleStroke.Color = Color3.fromRGB(80, 80, 80)
toggleStroke.Thickness = 2
toggleStroke.Parent = toggleButton

-- Create Vertical Column (Wider)
local columnFrame = Instance.new("Frame")
columnFrame.Name = "ColumnFrame"
columnFrame.Size = UDim2.new(0, 100, 0, 0)
columnFrame.Position = UDim2.new(0, 15, 0, 120)
columnFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
columnFrame.BackgroundTransparency = 0.3
columnFrame.BorderSizePixel = 0
columnFrame.ClipsDescendants = true
columnFrame.Visible = false
columnFrame.Parent = flyGui

local columnCorner = Instance.new("UICorner")
columnCorner.CornerRadius = UDim.new(0, 14)
columnCorner.Parent = columnFrame

local columnStroke = Instance.new("UIStroke")
columnStroke.Color = Color3.fromRGB(60, 60, 60)
columnStroke.Thickness = 2
columnStroke.Parent = columnFrame

-- Speed Increase Button (Top - Larger)
local increaseButton = Instance.new("TextButton")
increaseButton.Name = "IncreaseButton"
increaseButton.Size = UDim2.new(1, -16, 0, 65)
increaseButton.Position = UDim2.new(0, 8, 0, 8)
increaseButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
increaseButton.BackgroundTransparency = 0.3
increaseButton.Text = "âž•"
increaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
increaseButton.TextSize = 28
increaseButton.Font = Enum.Font.GothamBold
increaseButton.Parent = columnFrame

local incCorner = Instance.new("UICorner")
incCorner.CornerRadius = UDim.new(0, 10)
incCorner.Parent = increaseButton

local incStroke = Instance.new("UIStroke")
incStroke.Color = Color3.fromRGB(80, 80, 80)
incStroke.Thickness = 1
incStroke.Parent = increaseButton

-- Speed Display (Middle - Larger)
local speedDisplay = Instance.new("TextLabel")
speedDisplay.Name = "SpeedDisplay"
speedDisplay.Size = UDim2.new(1, -16, 0, 65)
speedDisplay.Position = UDim2.new(0, 8, 0, 80)
speedDisplay.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
speedDisplay.BackgroundTransparency = 0.4
speedDisplay.Text = "50"
speedDisplay.TextColor3 = Color3.fromRGB(220, 220, 220)
speedDisplay.TextSize = 22
speedDisplay.Font = Enum.Font.GothamBold
speedDisplay.Parent = columnFrame

local speedCorner = Instance.new("UICorner")
speedCorner.CornerRadius = UDim.new(0, 10)
speedCorner.Parent = speedDisplay

local speedStroke = Instance.new("UIStroke")
speedStroke.Color = Color3.fromRGB(70, 70, 70)
speedStroke.Thickness = 1
speedStroke.Parent = speedDisplay

-- Speed Decrease Button (Larger)
local decreaseButton = Instance.new("TextButton")
decreaseButton.Name = "DecreaseButton"
decreaseButton.Size = UDim2.new(1, -16, 0, 65)
decreaseButton.Position = UDim2.new(0, 8, 0, 152)
decreaseButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
decreaseButton.BackgroundTransparency = 0.3
decreaseButton.Text = "âž–"
decreaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
decreaseButton.TextSize = 28
decreaseButton.Font = Enum.Font.GothamBold
decreaseButton.Parent = columnFrame

local decCorner = Instance.new("UICorner")
decCorner.CornerRadius = UDim.new(0, 10)
decCorner.Parent = decreaseButton

local decStroke = Instance.new("UIStroke")
decStroke.Color = Color3.fromRGB(80, 80, 80)
decStroke.Thickness = 1
decStroke.Parent = decreaseButton

-- Start/Stop Button (Larger)
local startStopButton = Instance.new("TextButton")
startStopButton.Name = "StartStopButton"
startStopButton.Size = UDim2.new(1, -16, 0, 65)
startStopButton.Position = UDim2.new(0, 8, 0, 224)
startStopButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
startStopButton.BackgroundTransparency = 0.3
startStopButton.Text = "ðŸ”´"
startStopButton.TextColor3 = Color3.fromRGB(220, 220, 220)
startStopButton.TextSize = 24
startStopButton.Font = Enum.Font.GothamBold
startStopButton.Parent = columnFrame

local startStopCorner = Instance.new("UICorner")
startStopCorner.CornerRadius = UDim.new(0, 10)
startStopCorner.Parent = startStopButton

local startStopStroke = Instance.new("UIStroke")
startStopStroke.Color = Color3.fromRGB(70, 70, 70)
startStopStroke.Thickness = 1
startStopStroke.Parent = startStopButton

-- Close Button (Bottom - Fixed with proper X)
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(1, -16, 0, 50)
closeButton.Position = UDim2.new(0, 8, 0, 296)
closeButton.BackgroundColor3 = Color3.fromRGB(150, 30, 30)
closeButton.BackgroundTransparency = 0.3
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.TextSize = 24
closeButton.Font = Enum.Font.GothamBlack
closeButton.Parent = columnFrame

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 10)
closeCorner.Parent = closeButton

local closeStroke = Instance.new("UIStroke")
closeStroke.Color = Color3.fromRGB(200, 60, 60)
closeStroke.Thickness = 1
closeStroke.Parent = closeButton

-- Control variables
local isFlying = false
local flySpeed = 50
local bodyVelocity
local bodyGyro
local isColumnOpen = false
local isAnimating = false
local isClosing = false
local moveConnection
local currentSeat = nil
local seatAnchoredState = false

-- Update speed display
local function updateSpeedDisplay()
    speedDisplay.Text = tostring(flySpeed)
end

-- Safe character check function
local function getCharacter()
    local character = player.Character
    if character and character:IsDescendantOf(workspace) then
        return character
    end
    return nil
end

-- Enhanced seat detection function
local function getSeat()
    local character = getCharacter()
    if not character then return nil end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return nil end
    
    if humanoid.Sit then
        -- Check if sitting in VehicleSeat
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                local seat = part:FindFirstAncestorOfClass("VehicleSeat")
                if seat then
                    return seat
                end
            end
        end
        
        -- Check if sitting in Seat
        for _, seat in pairs(workspace:GetDescendants()) do
            if seat:IsA("Seat") and seat.Occupant == humanoid then
                return seat
            end
        end
    end
    
    return nil
end

-- Get the actual part to apply forces to
local function getFlyTarget()
    local seat = getSeat()
    if seat then
        if seat:IsA("Model") then
            return seat.PrimaryPart or seat:FindFirstChildWhichIsA("BasePart") or seat
        else
            return seat
        end
    else
        local character = getCharacter()
        if character then
            local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
            if humanoidRootPart then
                return humanoidRootPart
            end
        end
    end
    return nil
end

-- Simple click animation function
local function createClickAnimation(button)
    button.MouseButton1Down:Connect(function()
        if isClosing then return end
        local tween = TweenService:Create(button, TweenInfo.new(0.1), {
            Size = UDim2.new(1, -20, 0, button == closeButton and 45 or 60)
        })
        tween:Play()
    end)
    
    button.MouseButton1Up:Connect(function()
        if isClosing then return end
        local originalSize = UDim2.new(1, -16, 0, button == closeButton and 50 or 65)
        local tween = TweenService:Create(button, TweenInfo.new(0.1), {
            Size = originalSize
        })
        tween:Play()
    end)
end

-- Open column animation
local function openColumn()
    if isAnimating or isColumnOpen or isClosing then return end
    
    isAnimating = true
    columnFrame.Visible = true
    
    local tween = TweenService:Create(columnFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 100, 0, 354)
    })
    
    local toggleTween = TweenService:Create(toggleButton, TweenInfo.new(0.4), {
        Rotation = 180
    })
    
    tween:Play()
    toggleTween:Play()
    
    tween.Completed:Connect(function()
        isColumnOpen = true
        isAnimating = false
    end)
end

-- Close column animation
local function closeColumn()
    if isAnimating or not isColumnOpen or isClosing then return end
    
    isAnimating = true
    
    local tween = TweenService:Create(columnFrame, TweenInfo.new(0.4), {
        Size = UDim2.new(0, 100, 0, 0)
    })
    
    local toggleTween = TweenService:Create(toggleButton, TweenInfo.new(0.3), {
        Rotation = 0
    })
    
    tween:Play()
    toggleTween:Play()
    
    tween.Completed:Connect(function()
        columnFrame.Visible = false
        isColumnOpen = false
        isAnimating = false
    end)
end

-- Toggle column function
local function toggleColumn()
    if isAnimating or isClosing then return end
    
    if isColumnOpen then
        closeColumn()
    else
        openColumn()
    end
end

-- SIMPLE AND RELIABLE CLOSE FUNCTION
local function closeUI()
    if isClosing then return end
    isClosing = true
    
    -- Stop flying first
    if isFlying then
        stopFlying()
    end
    
    -- Disable all buttons
    toggleButton.Active = false
    increaseButton.Active = false
    decreaseButton.Active = false
    startStopButton.Active = false
    closeButton.Active = false
    
    -- Simple fade out animation for toggle button
    local toggleTween = TweenService:Create(toggleButton, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundTransparency = 1,
        ImageTransparency = 1
    })
    
    -- Simple fade out animation for column frame
    local columnTween = TweenService:Create(columnFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundTransparency = 1
    })
    
    -- Fade out all strokes
    local toggleStrokeTween = TweenService:Create(toggleStroke, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 1
    })
    
    local columnStrokeTween = TweenService:Create(columnStroke, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 1
    })
    
    -- Fade out all buttons in column
    local buttons = {increaseButton, decreaseButton, startStopButton, closeButton, speedDisplay}
    local buttonTweens = {}
    
    for _, button in pairs(buttons) do
        local tween = TweenService:Create(button, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundTransparency = 1,
            TextTransparency = 1
        })
        table.insert(buttonTweens, tween)
    end
    
    -- Fade out all strokes in buttons
    local strokes = {incStroke, decStroke, startStopStroke, closeStroke, speedStroke}
    local strokeTweens = {}
    
    for _, stroke in pairs(strokes) do
        local tween = TweenService:Create(stroke, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Transparency = 1
        })
        table.insert(strokeTweens, tween)
    end
    
    -- Start all animations
    toggleTween:Play()
    columnTween:Play()
    toggleStrokeTween:Play()
    columnStrokeTween:Play()
    
    for _, tween in pairs(buttonTweens) do
        tween:Play()
    end
    
    for _, tween in pairs(strokeTweens) do
        tween:Play()
    end
    
    -- Wait for animation to complete then destroy
    toggleTween.Completed:Connect(function()
        wait(0.1) -- Small delay to ensure everything faded
        flyGui:Destroy()
    end)
end

-- FLY FUNCTION - COMPLETELY FIXED NO TELEPORT
local function startFlying()
    if isFlying or isClosing then return end
    
    local character = getCharacter()
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local targetPart = getFlyTarget()
    
    if not humanoid or not targetPart then return end
    
    isFlying = true
    startStopButton.Text = "ðŸŸ¢"
    startStopButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    startStopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    
    -- Store current seat and its properties
    currentSeat = getSeat()
    if currentSeat then
        -- Store original anchored state
        if currentSeat:IsA("BasePart") then
            seatAnchoredState = currentSeat.Anchored
            currentSeat.Anchored = false
        elseif currentSeat:IsA("Model") and currentSeat.PrimaryPart then
            seatAnchoredState = currentSeat.PrimaryPart.Anchored
            currentSeat.PrimaryPart.Anchored = false
        end
        
        -- Disable vehicle seat movement
        if currentSeat:IsA("VehicleSeat") then
            currentSeat.MaxSpeed = 0
            currentSeat.SteerFloat = 0
            currentSeat.ThrottleFloat = 0
        end
    else
        -- If not sitting, enable platform stand
        humanoid.PlatformStand = true
    end
    
    -- Clean up any existing instances
    if bodyVelocity then
        bodyVelocity:Destroy()
        bodyVelocity = nil
    end
    if bodyGyro then
        bodyGyro:Destroy()
        bodyGyro = nil
    end
    
    -- Create BodyVelocity for movement
    bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.MaxForce = Vector3.new(100000, 100000, 100000)
    bodyVelocity.Parent = targetPart
    
    -- Create BodyGyro for stability
    bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(100000, 100000, 100000)
    bodyGyro.P = 10000
    bodyGyro.D = 1000
    bodyGyro.Parent = targetPart
    
    -- Make sure the target part can move
    if targetPart:IsA("BasePart") then
        targetPart.CanCollide = false
    end
    
    -- Movement connection
    moveConnection = RunService.Heartbeat:Connect(function()
        if not isFlying or not bodyVelocity or not bodyGyro or isClosing then
            if moveConnection then
                moveConnection:Disconnect()
                moveConnection = nil
            end
            return
        end
        
        local currentCharacter = getCharacter()
        if not currentCharacter then
            if moveConnection then
                moveConnection:Disconnect()
                moveConnection = nil
            end
            return
        end
        
        local currentHumanoid = currentCharacter:FindFirstChild("Humanoid")
        if not currentHumanoid then
            if moveConnection then
                moveConnection:Disconnect()
                moveConnection = nil
            end
            return
        end
        
        local currentTarget = getFlyTarget()
        if not currentTarget then
            if moveConnection then
                moveConnection:Disconnect()
                moveConnection = nil
            end
            return
        end
        
        -- Check if seat status changed
        local newSeat = getSeat()
        if newSeat ~= currentSeat then
            -- Seat status changed (jumped out or sat down)
            if currentSeat and not newSeat then
                -- Jumped out of seat - switch to character control
                currentSeat = nil
                
                -- Move controls to character
                if bodyVelocity.Parent ~= currentTarget then
                    bodyVelocity.Parent = currentTarget
                end
                if bodyGyro.Parent ~= currentTarget then
                    bodyGyro.Parent = currentTarget
                end
                
                -- Enable platform stand for character
                currentHumanoid.PlatformStand = true
            elseif newSeat and not currentSeat then
                -- Sat down in seat - switch to seat control
                currentSeat = newSeat
                
                -- Move controls to seat
                local seatTarget = getFlyTarget()
                if seatTarget then
                    if bodyVelocity.Parent ~= seatTarget then
                        bodyVelocity.Parent = seatTarget
                    end
                    if bodyGyro.Parent ~= seatTarget then
                        bodyGyro.Parent = seatTarget
                    end
                end
                
                -- Disable platform stand when sitting
                currentHumanoid.PlatformStand = false
            end
        end
        
        -- Ensure controls are on correct target
        if bodyVelocity.Parent ~= currentTarget then
            bodyVelocity.Parent = currentTarget
        end
        if bodyGyro.Parent ~= currentTarget then
            bodyGyro.Parent = currentTarget
        end
        
        -- Update platform stand based on sitting state
        local isSitting = getSeat() ~= nil
        if isSitting then
            currentHumanoid.PlatformStand = false
        else
            currentHumanoid.PlatformStand = true
        end
        
        local direction = Vector3.new(0, 0, 0)
        local camera = workspace.CurrentCamera
        
        if camera then
            local cameraCFrame = camera.CFrame
            local lookVector = cameraCFrame.LookVector
            local rightVector = cameraCFrame.RightVector
            
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                direction = direction + lookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                direction = direction - lookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                direction = direction - rightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                direction = direction + rightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                direction = direction + Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                direction = direction + Vector3.new(0, -1, 0)
            end
            
            -- Only apply rotation if we're moving or not sitting
            if not isSitting or direction.Magnitude > 0.1 then
                if direction.Magnitude > 0.1 then
                    bodyGyro.CFrame = CFrame.new(currentTarget.Position, currentTarget.Position + direction)
                else
                    bodyGyro.CFrame = CFrame.new(currentTarget.Position, currentTarget.Position + lookVector)
                end
            end
        end
        
        if direction.Magnitude > 0 then
            bodyVelocity.Velocity = direction.Unit * flySpeed
        else
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        end
    end)
end

-- STOP FLYING FUNCTION - COMPLETELY FIXED NO TELEPORT
local function stopFlying()
    if not isFlying then return end
    
    isFlying = false
    startStopButton.Text = "ðŸ”´"
    startStopButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    startStopButton.TextColor3 = Color3.fromRGB(220, 220, 220)
    
    if moveConnection then
        moveConnection:Disconnect()
        moveConnection = nil
    end
    
    local character = getCharacter()
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.PlatformStand = false
    end
    
    -- Restore seat properties WITHOUT teleporting
    if currentSeat then
        -- Restore anchored state
        if currentSeat:IsA("BasePart") then
            currentSeat.Anchored = seatAnchoredState
        elseif currentSeat:IsA("Model") and currentSeat.PrimaryPart then
            currentSeat.PrimaryPart.Anchored = seatAnchoredState
        end
        
        -- Restore vehicle seat properties
        if currentSeat:IsA("VehicleSeat") then
            currentSeat.MaxSpeed = 100
            currentSeat.SteerFloat = 0
            currentSeat.ThrottleFloat = 0
        end
    end
    
    -- Apply momentum for natural falling
    local targetPart = getFlyTarget()
    if targetPart and targetPart:IsA("BasePart") then
        -- Restore collision
        targetPart.CanCollide = true
        
        if bodyVelocity then
            local currentVelocity = bodyVelocity.Velocity
            
            -- Apply momentum for smooth transition
            local momentumVelocity = Instance.new("BodyVelocity")
            momentumVelocity.Velocity = Vector3.new(
                currentVelocity.X * 0.3,  -- Reduce horizontal momentum
                currentVelocity.Y * 0.2,  -- Reduce vertical momentum
                currentVelocity.Z * 0.3   -- Reduce horizontal momentum
            )
            momentumVelocity.MaxForce = Vector3.new(5000, 5000, 5000)
            momentumVelocity.Parent = targetPart
            
            -- Gradually reduce momentum
            local momentumTween = TweenService:Create(momentumVelocity, TweenInfo.new(1.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Velocity = Vector3.new(0, 0, 0)
            })
            momentumTween:Play()
            
            momentumTween.Completed:Connect(function()
                momentumVelocity:Destroy()
            end)
        end
    end
    
    -- Clean up flying controls
    if bodyVelocity then
        bodyVelocity:Destroy()
        bodyVelocity = nil
    end
    
    if bodyGyro then
        bodyGyro:Destroy()
        bodyGyro = nil
    end
    
    -- Clear seat data
    currentSeat = nil
    seatAnchoredState = false
end

-- Connect button events
decreaseButton.MouseButton1Click:Connect(function()
    if isClosing then return end
    flySpeed = math.max(10, flySpeed - 10)
    updateSpeedDisplay()
end)

increaseButton.MouseButton1Click:Connect(function()
    if isClosing then return end
    flySpeed = math.min(200, flySpeed + 10)
    updateSpeedDisplay()
end)

startStopButton.MouseButton1Click:Connect(function()
    if isClosing then return end
    if isFlying then
        stopFlying()
    else
        startFlying()
    end
end)

-- Close button event - SIMPLE AND WORKING
closeButton.MouseButton1Click:Connect(function()
    closeUI()
end)

-- Toggle button click
toggleButton.MouseButton1Click:Connect(function()
    if isClosing then return end
    toggleColumn()
end)

-- Apply click animations
createClickAnimation(increaseButton)
createClickAnimation(decreaseButton)
createClickAnimation(startStopButton)
createClickAnimation(closeButton)

-- Simple hover effects
local function setupHover(button)
    button.MouseEnter:Connect(function()
        if isClosing then return end
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.1
        })
        tween:Play()
    end)
    
    button.MouseLeave:Connect(function()
        if isClosing then return end
        local transparency = 0.3
        if button == startStopButton and isFlying then
            transparency = 0.2
        elseif button == closeButton then
            transparency = 0.3
        end
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundTransparency = transparency
        })
        tween:Play()
    end)
end

-- Special hover for close button
closeButton.MouseEnter:Connect(function()
    if isClosing then return end
    local tween = TweenService:Create(closeButton, TweenInfo.new(0.2), {
        BackgroundTransparency = 0.1,
        BackgroundColor3 = Color3.fromRGB(180, 40, 40),
        TextSize = 26
    })
    tween:Play()
end)

closeButton.MouseLeave:Connect(function()
    if isClosing then return end
    local tween = TweenService:Create(closeButton, TweenInfo.new(0.2), {
        BackgroundTransparency = 0.3,
        BackgroundColor3 = Color3.fromRGB(150, 30, 30),
        TextSize = 24
    })
    tween:Play()
end)

-- Toggle button hover
toggleButton.MouseEnter:Connect(function()
    if isClosing then return end
    local tween = TweenService:Create(toggleButton, TweenInfo.new(0.2), {
        BackgroundTransparency = 0.1
    })
    tween:Play()
end)

toggleButton.MouseLeave:Connect(function()
    if isClosing then return end
    local tween = TweenService:Create(toggleButton, TweenInfo.new(0.2), {
        BackgroundTransparency = 0.2
    })
    tween:Play()
end)

-- Apply hover effects
setupHover(increaseButton)
setupHover(decreaseButton)
setupHover(startStopButton)

-- Update initial display
updateSpeedDisplay()

-- Handle player respawn
player.CharacterAdded:Connect(function(character)
    if isFlying then
        stopFlying()
    end
end)
